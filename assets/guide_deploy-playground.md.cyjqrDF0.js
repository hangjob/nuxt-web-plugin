import{_ as i,c as a,o as n,ae as t}from"./chunks/framework.BmWoQP5w.js";const E=JSON.parse('{"title":"宝塔面板 + GitHub 自动化部署指南","description":"","frontmatter":{},"headers":[],"relativePath":"guide/deploy-playground.md","filePath":"guide/deploy-playground.md"}'),e={name:"guide/deploy-playground.md"};function l(h,s,p,k,d,r){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="宝塔面板-github-自动化部署指南" tabindex="-1">宝塔面板 + GitHub 自动化部署指南 <a class="header-anchor" href="#宝塔面板-github-自动化部署指南" aria-label="Permalink to &quot;宝塔面板 + GitHub 自动化部署指南&quot;">​</a></h1><p>对于使用宝塔面板 (BT) 的开发者，结合 <strong>GitHub Actions</strong> 可以实现一套非常顺畅的自动化部署流程：只需 <code>git push</code>，GitHub 就会自动构建项目并将产物同步到你的宝塔服务器上。</p><h2 id="_1-服务器环境准备" tabindex="-1">1. 服务器环境准备 <a class="header-anchor" href="#_1-服务器环境准备" aria-label="Permalink to &quot;1. 服务器环境准备&quot;">​</a></h2><p>在开始之前，请确保您的宝塔面板已满足以下条件：</p><ul><li><strong>网站环境</strong>：已创建一个“纯静态”站点（用于托管 Playground 的静态产物）。</li><li><strong>SSH 服务</strong>：确保宝塔面板 -&gt; 安全 -&gt; SSH 管理中，“SSH服务”已开启，且防火墙已放行 22 端口。</li><li><strong>Node.js 环境</strong>：建议在宝塔面板安装“Node.js 版本管理器”，并安装 v24.4.1 或更高版本。</li></ul><hr><h2 id="_2-ssh-免密登录配置-关键" tabindex="-1">2. SSH 免密登录配置 (关键) <a class="header-anchor" href="#_2-ssh-免密登录配置-关键" aria-label="Permalink to &quot;2. SSH 免密登录配置 (关键)&quot;">​</a></h2><p>为了让 GitHub Actions 能够免密登录你的服务器进行文件传输，必须配置 SSH 密钥对。</p><h3 id="a-生成-ssh-key" tabindex="-1">A. 生成 SSH Key <a class="header-anchor" href="#a-生成-ssh-key" aria-label="Permalink to &quot;A. 生成 SSH Key&quot;">​</a></h3><p>在你的<strong>本地电脑</strong>终端执行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成 ed25519 密钥（一直按回车，不要设置密码）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ed25519</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;github-actions-deploy&quot;</span></span></code></pre></div><h3 id="b-配置服务器受信列表" tabindex="-1">B. 配置服务器受信列表 <a class="header-anchor" href="#b-配置服务器受信列表" aria-label="Permalink to &quot;B. 配置服务器受信列表&quot;">​</a></h3><p>你需要把生成的公钥内容（通常是 <code>~/.ssh/id_ed25519.pub</code>）添加到服务器的信任列表中：</p><ol><li>复制公钥内容。</li><li>登录服务器，执行：<code>cat &gt;&gt; ~/.ssh/authorized_keys</code>，粘贴内容并回车。</li><li><strong>设置权限</strong>（极其重要）：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 700</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 600</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/authorized_keys</span></span></code></pre></div></li></ol><h3 id="c-如何查看密钥内容" tabindex="-1">C. 如何查看密钥内容 <a class="header-anchor" href="#c-如何查看密钥内容" aria-label="Permalink to &quot;C. 如何查看密钥内容&quot;">​</a></h3><p>如果你需要查看已经生成的密钥（例如为了复制到 GitHub Secrets），请在终端执行：</p><h4 id="查看私钥-用于-github-secrets" tabindex="-1">查看私钥 (用于 GitHub Secrets) <a class="header-anchor" href="#查看私钥-用于-github-secrets" aria-label="Permalink to &quot;查看私钥 (用于 GitHub Secrets)&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 本地或服务器执行（取决于你在哪生成的）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/id_ed25519</span></span></code></pre></div><blockquote><p><strong>注意</strong>：请务必完整复制从 <code>-----BEGIN...</code> 到 <code>-----END...</code> 的所有内容。</p></blockquote><h4 id="查看公钥-用于添加到服务器" tabindex="-1">查看公钥 (用于添加到服务器) <a class="header-anchor" href="#查看公钥-用于添加到服务器" aria-label="Permalink to &quot;查看公钥 (用于添加到服务器)&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/id_ed25519.pub</span></span></code></pre></div><h4 id="查看服务器已有的信任列表" tabindex="-1">查看服务器已有的信任列表 <a class="header-anchor" href="#查看服务器已有的信任列表" aria-label="Permalink to &quot;查看服务器已有的信任列表&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在服务器上执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/authorized_keys</span></span></code></pre></div><hr><h2 id="_3-配置-github-secrets" tabindex="-1">3. 配置 GitHub Secrets <a class="header-anchor" href="#_3-配置-github-secrets" aria-label="Permalink to &quot;3. 配置 GitHub Secrets&quot;">​</a></h2><p>GitHub 为了安全，不会直接在代码中显示敏感信息。你需要进入项目仓库 -&gt; <strong>Settings</strong> -&gt; <strong>Secrets and variables</strong> -&gt; <strong>Actions</strong>，点击 <strong>New repository secret</strong> 添加以下变量：</p><table tabindex="0"><thead><tr><th>Secret 名称</th><th>说明</th><th>示例值</th></tr></thead><tbody><tr><td><code>SERVER_HOST</code></td><td>服务器公网 IP 地址</td><td><code>1.2.3.4</code></td></tr><tr><td><code>SERVER_USER</code></td><td>SSH 登录用户名</td><td><code>root</code></td></tr><tr><td><code>SERVER_SSH_KEY</code></td><td>刚才生成的<strong>私钥</strong>全文 (<code>id_ed25519</code>)</td><td><code>-----BEGIN OPENSSH PRIVATE KEY-----...</code></td></tr><tr><td><code>SERVER_TARGET</code></td><td>宝塔站点的<strong>绝对路径</strong></td><td><code>/www/wwwroot/demo.yourdomain.com</code></td></tr></tbody></table><hr><h2 id="_4-自动化脚本-workflow" tabindex="-1">4. 自动化脚本 (Workflow) <a class="header-anchor" href="#_4-自动化脚本-workflow" aria-label="Permalink to &quot;4. 自动化脚本 (Workflow)&quot;">​</a></h2><p>在项目根目录创建 <code>.github/workflows/deploy-playground.yml</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deploy Playground</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;playground/**&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src/**&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  workflow_dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checkout</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup pnpm</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup Node</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">24</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install &amp; Build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          pnpm install --no-frozen-lockfile</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          pnpm run dev:prepare</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          cd playground</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          pnpm generate</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deploy to BT Server</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">easingthemes/ssh-deploy@main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          SSH_PRIVATE_KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.SERVER_SSH_KEY }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          ARGS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-rlgoDzvc -i --delete&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          SOURCE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;playground/.output/public/&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          REMOTE_HOST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.SERVER_HOST }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          REMOTE_USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.SERVER_USER }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          TARGET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.SERVER_TARGET }}</span></span></code></pre></div><hr><h2 id="_5-域名访问与-nginx-配置" tabindex="-1">5. 域名访问与 Nginx 配置 <a class="header-anchor" href="#_5-域名访问与-nginx-配置" aria-label="Permalink to &quot;5. 域名访问与 Nginx 配置&quot;">​</a></h2><p>由于 Nuxt (SSG) 默认使用路由 History 模式，刷新页面可能会出现 404。</p><p>在宝塔面板 -&gt; 网站 -&gt; 对应站点设置 -&gt; <strong>配置文件</strong> 或 <strong>伪静态</strong> 中添加：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try_files </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$uri $uri/ /index.html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="_6-常见问题排查" tabindex="-1">6. 常见问题排查 <a class="header-anchor" href="#_6-常见问题排查" aria-label="Permalink to &quot;6. 常见问题排查&quot;">​</a></h2><ul><li><strong>Host Key Verification Failed</strong>：通常是因为 GitHub 无法验证服务器指纹。<code>ssh-deploy</code> 插件默认会自动处理，如果失败，请检查 <code>SERVER_HOST</code> 是否填写正确。</li><li><strong>Permission Denied</strong>：请检查服务器上 <code>.ssh</code> 目录和 <code>authorized_keys</code> 文件的权限是否分别为 <code>700</code> 和 <code>600</code>。</li><li><strong>私钥格式不正确</strong>：确保粘贴到 Secrets 的私钥包含开头的 <code>-----BEGIN...</code> 和结尾的 <code>-----END...</code>。</li></ul><hr><h2 id="_7-关于-deploy-keys-的说明" tabindex="-1">7. 关于 Deploy Keys 的说明 <a class="header-anchor" href="#_7-关于-deploy-keys-的说明" aria-label="Permalink to &quot;7. 关于 Deploy Keys 的说明&quot;">​</a></h2><p>在本项目使用的 <strong>GitHub Actions (推模式)</strong> 方案中，<strong>不需要配置 GitHub 的 Deploy Keys</strong>。</p><ul><li><strong>原因</strong>：Deploy Keys 通常用于让服务器主动去拉取 (git pull) GitHub 上的私有代码。而本项目是通过 GitHub Actions 构建完成后，直接使用 SSH 协议将文件“推”送到服务器。</li><li><strong>配置重点</strong>：你只需要确保 <strong>GitHub Secrets</strong> 中的 <code>SERVER_SSH_KEY</code> 配置正确即可。</li></ul><hr><blockquote><p>参考来源：<a href="https://hangjob.github.io/strapi-plugin-bag/guide/deployment-bt.html" target="_blank" rel="noreferrer">Strapi Plugin Bag 部署指南</a></p></blockquote>`,45)])])}const g=i(e,[["render",l]]);export{E as __pageData,g as default};
